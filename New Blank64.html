<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>NeonForge Ultimate Pro</title><style>:root{--bg:#02030a;--panel:rgba(4,6,14,0.95);--text:#e8f4ff;--muted:#7a92c4;--accent:#00d4ff;--good:#20ff20;--warn:#ffaa20;--bad:#ff4040;--border:rgba(0,212,255,0.15);--glow:rgba(0,212,255,0.3)}*{box-sizing:border-box;margin:0;padding:0}html,body{height:100%;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Consolas,Monaco,monospace;overflow:hidden}canvas{position:fixed;top:0;left:0;width:100vw;height:100vh;display:block}.particle-canvas{position:fixed;top:0;left:0;pointer-events:none;z-index:5}#loadOverlay{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;z-index:9999}#loadBox{display:flex;flex-direction:column;align-items:center;gap:16px;color:var(--accent)}#loadSpin{width:80px;height:80px;border:4px solid rgba(78,224,255,0.1);border-top:4px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite}#loadText{font-size:18px;font-weight:600}#loadBar{width:320px;height:8px;background:rgba(255,255,255,0.05);border-radius:6px;overflow:hidden;position:relative}#loadFill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#7afcff);transition:width 0.3s ease;position:relative}#loadFill::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:neonFlow 1.5s infinite}#loadStatus{font-size:11px;color:var(--muted);margin-top:8px;text-align:center}#errorOverlay{position:fixed;top:0;left:0;width:100vw;height:100vh;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.95);z-index:10000}#errorCard{width:600px;max-width:90vw;padding:24px;border-radius:12px;background:linear-gradient(180deg,rgba(68,0,17,0.8),rgba(102,0,34,0.9));border:2px solid var(--bad);text-align:center}#errorTitle{font-size:24px;font-weight:800;color:var(--bad);margin-bottom:12px}#errorMessage{color:var(--text);margin-bottom:20px;line-height:1.6}#errorDetails{background:rgba(0,0,0,0.5);padding:12px;border-radius:6px;font-family:monospace;font-size:11px;max-height:200px;overflow:auto;text-align:left;margin-bottom:16px}#errorRetry{padding:12px 24px;background:linear-gradient(135deg,var(--accent),#40ffff);color:#000;border:none;border-radius:8px;font-weight:700;cursor:pointer}#introOverlay{position:fixed;top:0;left:0;width:100vw;height:100vh;display:none;align-items:center;justify-content:center;z-index:9998;backdrop-filter:blur(10px)}#introCard{position:relative;width:780px;max-width:92vw;padding:28px;border-radius:16px;background:linear-gradient(180deg,rgba(2,6,12,0.6),rgba(2,6,12,0.9));border:1px solid var(--border);backdrop-filter:blur(12px);box-shadow:0 0 40px rgba(0,212,255,0.3)}#introTitle{font-size:32px;font-weight:800;margin-bottom:8px;color:var(--accent);text-shadow:0 0 20px var(--glow)}#introSub{color:var(--muted);margin-bottom:20px;font-size:16px}#introFeatures{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:20px 0}#introFeatures div{padding:12px;background:rgba(0,212,255,0.05);border-radius:8px;border:1px solid var(--border)}#introButtons{display:flex;gap:12px;align-items:center;margin-top:20px}#startBtn{padding:14px 28px;border-radius:12px;background:linear-gradient(90deg,var(--accent),#7afcff);color:#001a24;font-weight:800;border:none;cursor:pointer;font-size:16px;box-shadow:0 0 20px var(--glow);transition:all 0.3s}#startBtn:hover{transform:translateY(-2px);box-shadow:0 0 30px var(--glow)}#skipBtn{padding:12px 20px;border-radius:10px;background:transparent;border:1px solid var(--border);color:var(--text);cursor:pointer;font-size:14px}#mainUI{position:fixed;top:10px;left:10px;width:520px;max-height:calc(100vh - 20px);background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px;font-size:12px;overflow-y:auto;z-index:100;backdrop-filter:blur(12px);box-shadow:0 0 35px rgba(0,212,255,0.25);display:none}#tabs{display:flex!important;gap:6px;margin-bottom:10px;flex-wrap:wrap}#tabs button{background:linear-gradient(135deg,#001122,#002244);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer;font-size:11px;transition:all 0.2s;min-width:70px;font-weight:600}#tabs button:hover{background:linear-gradient(135deg,#002244,#003366);box-shadow:0 0 12px var(--glow);transform:translateY(-1px)}#tabs button.active{background:linear-gradient(135deg,var(--accent),#40ffff);color:#000;box-shadow:0 0 18px var(--glow)}input[type="range"]{width:100%;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;outline:none;margin:6px 0;appearance:none}input[type="range"]::-webkit-slider-thumb{appearance:none;width:14px;height:14px;background:var(--accent);border-radius:50%;cursor:pointer;box-shadow:0 0 10px var(--glow)}input[type="range"]::-moz-range-thumb{width:14px;height:14px;background:var(--accent);border-radius:50%;cursor:pointer;border:none;box-shadow:0 0 10px var(--glow)}input[type="number"],select{width:100%;background:linear-gradient(135deg,#001122,#002244);border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:6px;font-size:11px}button{background:linear-gradient(135deg,#001122,#002244);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer;font-size:11px;transition:all 0.2s;font-weight:600}button:hover{background:linear-gradient(135deg,#002244,#003366);box-shadow:0 0 12px var(--glow);transform:translateY(-1px)}button:active{transform:scale(0.98)}button.danger{background:linear-gradient(135deg,#440011,#660022);border-color:rgba(255,64,64,0.3)}button.danger:hover{background:linear-gradient(135deg,#660022,#880033);box-shadow:0 0 12px rgba(255,64,64,0.3)}label{display:block;color:var(--muted);margin-top:8px;font-size:11px;font-weight:600}pre{background:rgba(0,10,20,0.8);padding:8px;border-radius:6px;font-size:10px;max-height:150px;overflow:auto;margin:6px 0;border:1px solid rgba(0,212,255,0.1);font-family:Consolas,Monaco,monospace;line-height:1.4}#footer{position:fixed;bottom:10px;right:10px;background:var(--panel);padding:10px 14px;border-radius:10px;border:1px solid var(--border);font-size:11px;backdrop-filter:blur(10px);box-shadow:0 0 25px rgba(0,212,255,0.2);z-index:100}#notification{position:fixed;top:20px;right:20px;background:var(--panel);padding:12px 16px;border-radius:10px;border:1px solid var(--border);font-size:12px;backdrop-filter:blur(10px);box-shadow:0 0 25px rgba(0,212,255,0.2);z-index:200;display:none;max-width:300px}#notification.success{border-color:var(--good);box-shadow:0 0 25px rgba(32,255,32,0.3)}#notification.warning{border-color:var(--warn);box-shadow:0 0 25px rgba(255,170,32,0.3)}#notification.error{border-color:var(--bad);box-shadow:0 0 25px rgba(255,64,64,0.3)}#physicsViz{position:fixed;top:10px;right:10px;width:280px;height:240px;background:rgba(0,10,20,0.92);border:1px solid var(--border);border-radius:10px;padding:10px;font-size:10px;display:none;backdrop-filter:blur(8px);box-shadow:0 0 20px rgba(0,212,255,0.15)}#perfGraph{position:fixed;bottom:10px;left:10px;width:340px;height:140px;background:rgba(0,10,20,0.92);border:1px solid var(--border);border-radius:10px;display:none;padding:10px}#benchProgress{height:100px;background:rgba(0,10,20,0.8);border:1px solid var(--border);border-radius:6px;margin:6px 0;overflow:hidden;position:relative}#benchProgress::before{content:'';position:absolute;top:0;left:0;width:100%;height:2px;background:linear-gradient(90deg,transparent,var(--accent),transparent);animation:dataFlow 2.5s infinite linear}#gamesList{max-height:280px;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--accent) transparent}#gamesList .game-item{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;margin:3px 0;background:rgba(0,10,20,0.4);border-radius:6px;border-left:3px solid transparent;transition:all 0.2s}#gamesList .game-item:hover{background:rgba(0,10,20,0.6);transform:translateX(4px)}#gamesList .game-item.ultra{border-left-color:#00ff00}#gamesList .game-item.high{border-left-color:var(--good)}#gamesList .game-item.medium{border-left-color:var(--warn)}#gamesList .game-item.low{border-left-color:#ff8800}#gamesList .game-item.unplayable{border-left-color:var(--bad)}#gamesList .game-category{color:var(--accent);font-weight:bold;margin:10px 0 4px 0;padding-bottom:3px;border-bottom:1px solid var(--border);font-size:12px}#systemGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0}#systemGrid .metric{background:rgba(0,10,20,0.5);padding:8px;border-radius:6px;border:1px solid var(--border);transition:all 0.2s}#systemGrid .metric:hover{background:rgba(0,10,20,0.7);border-color:var(--accent)}#systemGrid .metric .label{color:var(--muted);font-size:10px;margin-bottom:4px}#systemGrid .metric .value{color:var(--accent);font-weight:bold;font-size:13px}#worldControls,#physicsControls{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin:10px 0}#benchControls{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin:10px 0}#compareResults{margin-top:12px;padding:12px;background:rgba(0,10,20,0.5);border-radius:8px;border:1px solid var(--border)}#historyList{max-height:200px;overflow-y:auto}#historyList .history-item{padding:8px;margin:4px 0;background:rgba(0,10,20,0.4);border-radius:6px;border-left:3px solid var(--accent);cursor:pointer;transition:all 0.2s}#historyList .history-item:hover{background:rgba(0,10,20,0.6);transform:translateX(4px)}#historyList .history-item.selected{background:rgba(0,10,20,0.7);border-left-color:#40ffff}.emergency-stop{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(102,0,34,0.95);border:2px solid var(--bad);padding:20px;border-radius:12px;z-index:9999;display:none;text-align:center}.emergency-stop button{background:var(--bad);color:#fff;padding:12px 24px;font-size:14px;font-weight:bold}@keyframes spin{to{transform:rotate(360deg)}}@keyframes dataFlow{0%{transform:translateX(-100%);opacity:0}50%{opacity:1}100%{transform:translateX(300%);opacity:0}}@keyframes neonFlow{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}@media(max-width:900px){#mainUI{width:calc(100vw - 20px);max-width:500px;font-size:11px}#worldControls,#physicsControls{grid-template-columns:1fr}#systemGrid{grid-template-columns:1fr}#introCard{padding:20px}#introFeatures{grid-template-columns:1fr}}@media(max-width:600px){#tabs button{padding:6px 8px;min-width:60px;font-size:10px}#footer{font-size:10px;padding:8px 10px}#introTitle{font-size:24px}#loadText{font-size:14px}}</style></head><body><canvas id="introCanvas"></canvas><canvas id="mainCanvas"></canvas><canvas id="particleCanvas" class="particle-canvas"></canvas><div id="loadOverlay"><div id="loadBox"><div id="loadSpin"></div><div id="loadText">Initializing...</div><div id="loadBar"><div id="loadFill"></div></div><div id="loadStatus">Calibrating baseline performance...</div></div></div><div id="errorOverlay"><div id="errorCard"><div id="errorTitle">âš  Error Occurred</div><div id="errorMessage"></div><div id="errorDetails"></div><button id="errorRetry">Retry</button></div></div><div id="introOverlay"><div id="introCard"><div id="introTitle">NeonForge Ultimate Pro</div><div id="introSub">GPU Stress Visualizer â€¢ Physics Simulator â€¢ Performance Analyzer</div><div style="background:rgba(255,170,32,0.1);border:1px solid var(--warn);border-radius:8px;padding:10px;margin:12px 0;font-size:11px"><strong>âš  Important:</strong> This is a stress visualizer, not a standardized benchmark. Results are relative indicators for your system and should not be compared across different hardware configurations.</div><div id="introFeatures"><div><strong>ðŸŽ® 26+ Games</strong><br>Performance predictions</div><div><strong>âš¡ 5 Physics Methods</strong><br>Euler, RK4, Symplectic, MD</div><div><strong>ðŸ“Š Pro Metrics</strong><br>1% & 0.1% lows</div><div><strong>ðŸŒŠ 5 Shaders</strong><br>Neon, Plasma, Fractal</div></div><div id="introButtons"><button id="startBtn">Start Calibration & Visualizer</button><button id="skipBtn">Skip to Interface</button></div></div></div><div id="notification"></div><div class="emergency-stop" id="emergencyStop"><div style="font-size:16px;font-weight:bold;margin-bottom:12px;color:var(--bad)">âš  THERMAL PROTECTION</div><div style="margin-bottom:16px">Benchmark runtime exceeded safe limit<br>Consider stopping to prevent overheating</div><button onclick="forceStopBenchmark()">EMERGENCY STOP</button></div><div id="physicsViz"><div style="color:var(--accent);font-weight:bold;margin-bottom:6px;font-size:11px">Physics Engine</div><div id="physicsData">Idle</div></div><div id="perfGraph"><canvas id="perfCanvas" width="320" height="120"></canvas></div><div id="mainUI"><div style="font-weight:bold;color:var(--accent);margin-bottom:10px;font-size:15px">NeonForge Ultimate Pro v3.2</div><div id="tabs"></div><div id="world" class="tab-content"><div id="worldControls"></div><label>World Seed <span id="seedLabel">12345</span></label><input id="worldSeed" type="range" min="1" max="99999" step="1" value="12345"><label>Render Distance <span id="renderLabel">32</span></label><input id="renderDist" type="range" min="8" max="128" step="1" value="32"><label>Detail Level <span id="detailLabel">16</span></label><input id="chunkDetail" type="range" min="4" max="64" step="1" value="16"><label>Render Scale (DPI) <span id="renderScaleLabel">1.0x</span></label><input id="renderScale" type="range" min="0.25" max="2.0" step="0.05" value="1.0"><label>Scene Type</label><select id="sceneType"><option value="neon">Neon Waves</option><option value="particles" selected>Particle Storm</option><option value="rain">Digital Rain</option><option value="plasma">Plasma Field</option><option value="fractal">Fractal Noise</option></select><pre id="worldInfo">World Generator Ready</pre></div><div id="physics" class="tab-content" style="display:none"><div id="physicsControls"></div><label>Integration Method</label><select id="integrationMethod"><option value="verlet">Verlet (Default)</option><option value="euler">Euler Method</option><option value="rk4">Runge-Kutta 4</option><option value="symplectic">Symplectic Euler</option><option value="molecular">Molecular Dynamics</option></select><label>Render Particles <span id="renderPartLabel">5000</span></label><input id="renderPartCount" type="range" min="100" max="50000" step="100" value="5000"><label>Simulation Particles <span id="simPartLabel">5000</span></label><input id="simPartCount" type="range" min="100" max="50000" step="100" value="5000"><label>Gravity <span id="gravLabel">-9.8</span></label><input id="gravity" type="range" min="-50" max="50" step="0.1" value="-9.8"><label>Air Resistance <span id="airLabel">0.02</span></label><input id="airRes" type="range" min="0" max="1" step="0.001" value="0.02"><label>Bounce Factor <span id="bounceLabel">0.8</span></label><input id="bounceFactor" type="range" min="0" max="2" step="0.01" value="0.8"><label>Max Velocity <span id="maxVelLabel">1000</span></label><input id="maxVelocity" type="range" min="100" max="5000" step="50" value="1000"><label>Fixed Timestep <span id="dtLabel">0.016</span></label><input id="timeStep" type="range" min="0.001" max="0.1" step="0.001" value="0.016"><label>Lennard-Jones Îµ <span id="ljEpsilonLabel">1.0</span></label><input id="ljEpsilon" type="range" min="0.1" max="5" step="0.1" value="1.0"><label>Lennard-Jones Ïƒ <span id="ljSigmaLabel">1.0</span></label><input id="ljSigma" type="range" min="0.1" max="5" step="0.1" value="1.0"><label>FPS Cap</label><select id="fpsCap"><option value="0">Unlimited</option><option value="30">30 FPS</option><option value="60" selected>60 FPS</option><option value="120">120 FPS</option><option value="144">144 FPS</option></select><pre id="physicsLog">Advanced Physics Ready</pre></div><div id="bench" class="tab-content" style="display:none"><div id="benchControls"></div><label>Benchmark Duration</label><select id="benchDuration"><option value="15">Quick - 15s</option><option value="60" selected>Standard - 1min</option><option value="300">Extended - 5min</option><option value="900">Long - 15min</option></select><label>Stress Test Mode</label><select id="stressMode"><option value="light">Light Load</option><option value="medium" selected>Medium Load</option><option value="heavy">Heavy Load</option><option value="extreme">Extreme Stress</option></select><label><input type="checkbox" id="deterministicMode"> Deterministic mode (fixed seed for repeatable results)</label><label><input type="checkbox" id="thermalWarning"> Accept thermal risk (>5min tests)</label><label><input type="checkbox" id="autoSave" checked> Auto-save results</label><label><input type="checkbox" id="recordData" checked> Record detailed metrics</label><label><input type="checkbox" id="emergencyStopEnabled" checked> Enable emergency stop (10min limit)</label><pre id="benchResults">Stress Visualizer Ready\n\nNote: This tool measures relative GPU/CPU stress.\nResults are NOT comparable across different systems.</pre><div id="benchProgress"></div></div><div id="games" class="tab-content" style="display:none"><label>Performance Profile</label><select id="perfProfile"><option value="mobile">Mobile Gaming</option><option value="console">Console Quality</option><option value="pc" selected>Desktop PC</option><option value="enthusiast">High-End PC</option></select><label>Target Resolution</label><select id="targetRes"><option value="720p">HD 720p</option><option value="1080p" selected>Full HD 1080p</option><option value="1440p">QHD 1440p</option><option value="4k">Ultra HD 4K</option></select><label>Graphics Settings</label><select id="graphicsPreset"><option value="low">Low Settings</option><option value="medium">Medium Settings</option><option value="high" selected>High Settings</option><option value="ultra">Ultra Settings</option></select><div id="gamesList"><div style="color:var(--muted);margin:10px 0;text-align:center">Run benchmark to generate game performance predictions</div></div></div><div id="system" class="tab-content" style="display:none"><div id="systemGrid"><div class="metric"><div class="label">GPU Renderer</div><div class="value" id="gpuInfo">Detecting...</div></div><div class="metric"><div class="label">WebGL Version</div><div class="value" id="webglInfo">Unknown</div></div><div class="metric"><div class="label">Available RAM</div><div class="value" id="ramInfo">0 MB</div></div><div class="metric"><div class="label">CPU Cores</div><div class="value" id="cpuInfo">0</div></div><div class="metric"><div class="label">Screen Resolution</div><div class="value" id="screenInfo">0x0</div></div><div class="metric"><div class="label">Device Type</div><div class="value" id="deviceType">Unknown</div></div><div class="metric"><div class="label">Baseline FPS</div><div class="value" id="baselineFps">N/A</div></div><div class="metric"><div class="label">Load Capacity</div><div class="value" id="loadCapacity">N/A</div></div></div><pre id="diagnosticsLog">System Analysis Ready</pre></div><div id="history" class="tab-content" style="display:none"><label style="color:var(--accent);font-weight:bold;font-size:12px">Benchmark History</label><div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin:10px 0"><button onclick="loadHistory()">Load History</button><button onclick="clearHistory()">Clear All</button></div><div id="historyList"><div style="color:var(--muted);text-align:center;padding:20px">No benchmark history</div></div><div id="compareResults"></div></div></div><div id="footer">Status: Loading</div><script>
"use strict";const APP={version:"3.2.0",maxParticles:{mobile:1000,tablet:5000,desktop:20000},maxHistoryItems:50,maxFpsSamples:120,maxBenchSamples:10000,fpsHistorySize:100,fixedTimestep:0.016,maxTimestepAccumulator:0.25,emergencyStopTime:600000,velocityClampDefault:1000};const DOM={};const state={loading:true,introPhase:0,currentScene:"particles",benchRunning:false,benchPaused:false,benchStartTime:0,benchPausedTime:0,benchSamples:[],lastBenchmark:null,frameCount:0,fpsSamples:[],fpsHistory:[],lastFrameTime:0,startTime:0,physicsActive:false,particles:[],history:[],perfGraphActive:false,contextLost:false,isVisible:true,deviceType:"desktop",gpuTier:"medium",selectedHistoryItems:new Set(),fpsCap:60,integrationMethod:"verlet",timestepAccumulator:0,baselineFps:0,maxLoad:0,calibrationComplete:false,renderScale:1.0,deterministicSeed:12345,randomSeed:12345,renderParticleCount:5000,simParticleCount:5000,lastEmergencyCheck:0};const canvas={intro:null,main:null,particle:null};const gl={intro:null,main:null};const programs={};const resources={shaders:[],programs:[],buffers:[]};const shaders={vertexShader:`attribute vec2 a_position;void main(){gl_Position=vec4(a_position,0.0,1.0);}`,neonFragment:`precision highp float;uniform vec2 u_resolution;uniform float u_time;uniform float u_intensity;uniform float u_complexity;void main(){vec2 uv=(gl_FragCoord.xy/u_resolution.xy)*2.0-1.0;uv.x*=u_resolution.x/u_resolution.y;float d=length(uv);float angle=atan(uv.y,uv.x);float r=0.0;for(float i=1.0;i<=8.0;i++){float freq=i*u_complexity;r+=sin(d*freq-u_time*2.0+angle*i)*0.5/i;}r*=u_intensity;vec3 col=vec3(0.0,0.8+r*0.5,1.0+r*0.3);col*=1.0-d*0.3;gl_FragColor=vec4(col,1.0);}`,particlesFragment:`precision highp float;uniform vec2 u_resolution;uniform float u_time;uniform float u_intensity;uniform float u_complexity;float hash(vec2 p){return fract(sin(dot(p,vec2(127.1,311.7)))*43758.5453);}void main(){vec2 uv=gl_FragCoord.xy/u_resolution.xy;vec3 col=vec3(0.02,0.03,0.06);for(float i=0.0;i<100.0;i++){if(i>=u_complexity*12.0)break;vec2 seed=vec2(i*0.1,i*0.2);float h=hash(seed);vec2 pos=vec2(h,hash(seed+1.0));pos.x+=sin(u_time*0.5+h*6.28)*0.3;pos.y=fract(pos.y-u_time*0.1*(0.5+h*0.5));float dist=distance(uv,pos);float brightness=u_intensity*0.01/dist;col+=vec3(0.0,0.5,1.0)*brightness;}gl_FragColor=vec4(col,1.0);}`,rainFragment:`precision highp float;uniform vec2 u_resolution;uniform float u_time;uniform float u_intensity;uniform float u_complexity;float rand(vec2 co){return fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453);}void main(){vec2 uv=gl_FragCoord.xy/u_resolution.xy;vec3 col=vec3(0.0);float layers=u_complexity*2.0;for(float i=0.0;i<32.0;i++){if(i>=layers)break;float depth=i/layers;vec2 st=uv*vec2(20.0+i*5.0,40.0+i*10.0);st.y+=u_time*(1.0+depth)*2.0;vec2 id=floor(st);float n=rand(id);if(n>0.7){vec2 p=fract(st)-0.5;float y=fract(u_time*(1.0+depth)*2.0+n);p.y=y-0.5;float d=length(p);float brightness=u_intensity*0.02/d*(1.0-depth*0.5);col+=vec3(0.0,brightness*0.8,brightness);}}gl_FragColor=vec4(col,1.0);}`,plasmaFragment:`precision highp float;uniform vec2 u_resolution;uniform float u_time;uniform float u_intensity;uniform float u_complexity;void main(){vec2 uv=(gl_FragCoord.xy/u_resolution.xy)*2.0-1.0;uv.x*=u_resolution.x/u_resolution.y;float v=0.0;for(float i=1.0;i<=16.0;i++){if(i>u_complexity*2.0)break;v+=sin(uv.x*i+u_time);v+=cos(uv.y*i+u_time*1.3);v+=sin(length(uv)*i*2.0-u_time*2.0);}v*=u_intensity*0.1;vec3 col=vec3(sin(v),sin(v+2.1),sin(v+4.2))*0.5+0.5;gl_FragColor=vec4(col,1.0);}`,fractalFragment:`precision highp float;uniform vec2 u_resolution;uniform float u_time;uniform float u_intensity;uniform float u_complexity;void main(){vec2 uv=(gl_FragCoord.xy/u_resolution.xy)*2.0-1.0;uv.x*=u_resolution.x/u_resolution.y;vec2 z=uv*2.0;float iterations=u_complexity*8.0;float n=0.0;for(float i=0.0;i<128.0;i++){if(i>=iterations)break;if(dot(z,z)>4.0)break;z=vec2(z.x*z.x-z.y*z.y,2.0*z.x*z.y)+uv*sin(u_time*0.2);n++;}n/=iterations;vec3 col=vec3(n*u_intensity);col=pow(col,vec3(0.5));gl_FragColor=vec4(col,1.0);}`};function seededRandom(){const x=Math.sin(state.randomSeed++)*10000;return x-Math.floor(x);}
function initDOM(){const ids=["loadOverlay","loadText","loadFill","loadStatus","errorOverlay","errorCard","errorTitle","errorMessage","errorDetails","errorRetry","introOverlay","startBtn","skipBtn","mainUI","tabs","footer","notification","worldSeed","renderDist","chunkDetail","sceneType","worldInfo","gravity","airRes","bounceFactor","renderPartCount","simPartCount","fpsCap","physicsLog","benchDuration","stressMode","thermalWarning","autoSave","recordData","benchResults","benchProgress","perfProfile","targetRes","graphicsPreset","gamesList","gpuInfo","webglInfo","ramInfo","cpuInfo","screenInfo","deviceType","diagnosticsLog","historyList","compareResults","physicsData","physicsViz","perfGraph","perfCanvas","world","physics","bench","games","system","history","worldControls","physicsControls","benchControls","seedLabel","renderLabel","detailLabel","gravLabel","airLabel","bounceLabel","renderPartLabel","simPartLabel","integrationMethod","timeStep","dtLabel","ljEpsilon","ljEpsilonLabel","ljSigma","ljSigmaLabel","maxVelocity","maxVelLabel","renderScale","renderScaleLabel","deterministicMode","emergencyStopEnabled","emergencyStop","baselineFps","loadCapacity"];ids.forEach(function(id){DOM[id]=document.getElementById(id);});canvas.intro=document.getElementById("introCanvas");canvas.main=document.getElementById("mainCanvas");canvas.particle=document.getElementById("particleCanvas");}
function detectDevice(){const w=window.innerWidth;const cores=navigator.hardwareConcurrency||2;const memory=navigator.deviceMemory||4;if(w<768||memory<4){state.deviceType="mobile";state.gpuTier="low";return"mobile";}else if(w<1280||memory<8||cores<4){state.deviceType="tablet";state.gpuTier="medium";return"tablet";}else{state.deviceType="desktop";state.gpuTier=cores>=8&&memory>=16?"high":"medium";return"desktop";}}
function getMaxParticles(){return APP.maxParticles[state.deviceType];}
function updateLoading(percent,text,status){DOM.loadFill.style.width=percent+"%";if(text)DOM.loadText.textContent=text;if(status)DOM.loadStatus.textContent=status;}
function showError(title,message,details){DOM.errorTitle.textContent=title;DOM.errorMessage.textContent=message;DOM.errorDetails.textContent=details||"";DOM.errorDetails.style.display=details?"block":"none";DOM.errorOverlay.style.display="flex";}
function hideError(){DOM.errorOverlay.style.display="none";}
function showNotification(message,type,duration){type=type||"success";duration=duration||3000;DOM.notification.textContent=message;DOM.notification.className=type;DOM.notification.style.display="block";setTimeout(function(){DOM.notification.style.display="none";},duration);}
function initWebGL(){try{const options={alpha:false,depth:false,stencil:false,antialias:false,powerPreference:"high-performance",failIfMajorPerformanceCaveat:false};gl.intro=canvas.intro.getContext("webgl",options)||canvas.intro.getContext("experimental-webgl",options);gl.main=canvas.main.getContext("webgl",options)||canvas.main.getContext("experimental-webgl",options);if(!gl.intro||!gl.main){showError("WebGL Not Supported","Your browser doesn't support WebGL.","Please use Chrome, Firefox, or Edge.");return false;}setupContextLossHandling(gl.intro,canvas.intro);setupContextLossHandling(gl.main,canvas.main);return true;}catch(e){showError("WebGL Failed","Failed to initialize WebGL.",e.message);return false;}}
function setupContextLossHandling(glContext,canvasElement){canvasElement.addEventListener("webglcontextlost",function(e){e.preventDefault();state.contextLost=true;showNotification("GPU context lost - recovering...","warning",5000);},false);canvasElement.addEventListener("webglcontextrestored",function(){state.contextLost=false;showNotification("GPU context restored!","success");cleanupResources();initScenes();},false);}
function createShader(glContext,type,source){const shader=glContext.createShader(type);glContext.shaderSource(shader,source);glContext.compileShader(shader);if(!glContext.getShaderParameter(shader,glContext.COMPILE_STATUS)){const error=glContext.getShaderInfoLog(shader);glContext.deleteShader(shader);throw new Error("Shader error: "+error);}resources.shaders.push(shader);return shader;}
function createProgram(glContext,vertexShader,fragmentShader){const program=glContext.createProgram();glContext.attachShader(program,vertexShader);glContext.attachShader(program,fragmentShader);glContext.linkProgram(program);if(!glContext.getProgramParameter(program,glContext.LINK_STATUS)){const error=glContext.getProgramInfoLog(program);throw new Error("Program error: "+error);}resources.programs.push(program);return program;}
function initScenes(){const scenes=["neon","particles","rain","plasma","fractal"];scenes.forEach(function(sceneName){try{const vertShader=createShader(gl.intro,gl.intro.VERTEX_SHADER,shaders.vertexShader);const fragShader=createShader(gl.intro,gl.intro.FRAGMENT_SHADER,shaders[sceneName+"Fragment"]);const prog=createProgram(gl.intro,vertShader,fragShader);const posBuffer=gl.intro.createBuffer();gl.intro.bindBuffer(gl.intro.ARRAY_BUFFER,posBuffer);gl.intro.bufferData(gl.intro.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),gl.intro.STATIC_DRAW);resources.buffers.push(posBuffer);programs[sceneName]={program:prog,posBuffer:posBuffer,posLoc:gl.intro.getAttribLocation(prog,"a_position"),resLoc:gl.intro.getUniformLocation(prog,"u_resolution"),timeLoc:gl.intro.getUniformLocation(prog,"u_time"),intLoc:gl.intro.getUniformLocation(prog,"u_intensity"),compLoc:gl.intro.getUniformLocation(prog,"u_complexity")};}catch(e){showError("Shader Error","Failed to compile "+sceneName,e.message);}});scenes.forEach(function(sceneName){try{const vertShader=createShader(gl.main,gl.main.VERTEX_SHADER,shaders.vertexShader);const fragShader=createShader(gl.main,gl.main.FRAGMENT_SHADER,shaders[sceneName+"Fragment"]);const prog=createProgram(gl.main,vertShader,fragShader);const posBuffer=gl.main.createBuffer();gl.main.bindBuffer(gl.main.ARRAY_BUFFER,posBuffer);gl.main.bufferData(gl.main.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),gl.main.STATIC_DRAW);resources.buffers.push(posBuffer);const key="main_"+sceneName;programs[key]={program:prog,posBuffer:posBuffer,posLoc:gl.main.getAttribLocation(prog,"a_position"),resLoc:gl.main.getUniformLocation(prog,"u_resolution"),timeLoc:gl.main.getUniformLocation(prog,"u_time"),intLoc:gl.main.getUniformLocation(prog,"u_intensity"),compLoc:gl.main.getUniformLocation(prog,"u_complexity")};}catch(e){showError("Shader Error","Failed to compile main "+sceneName,e.message);}});}
function cleanupResources(){resources.shaders.forEach(function(shader){if(gl.intro)gl.intro.deleteShader(shader);if(gl.main)gl.main.deleteShader(shader);});resources.programs.forEach(function(program){if(gl.intro)gl.intro.deleteProgram(program);if(gl.main)gl.main.deleteProgram(program);});resources.buffers.forEach(function(buffer){if(gl.intro)gl.intro.deleteBuffer(buffer);if(gl.main)gl.main.deleteBuffer(buffer);});resources.shaders=[];resources.programs=[];resources.buffers=[];}
function renderScene(glContext,sceneData,timestamp){if(!sceneData||state.contextLost)return;try{glContext.useProgram(sceneData.program);glContext.bindBuffer(glContext.ARRAY_BUFFER,sceneData.posBuffer);glContext.enableVertexAttribArray(sceneData.posLoc);glContext.vertexAttribPointer(sceneData.posLoc,2,glContext.FLOAT,false,0,0);glContext.uniform2f(sceneData.resLoc,glContext.canvas.width,glContext.canvas.height);glContext.uniform1f(sceneData.timeLoc,timestamp*0.001);glContext.uniform1f(sceneData.intLoc,1.0);glContext.uniform1f(sceneData.compLoc,4.0);glContext.drawArrays(glContext.TRIANGLE_STRIP,0,4);}catch(e){console.error("Render error:",e);}}
async function runCalibration(){updateLoading(10,"Calibrating...","Running baseline performance test");await new Promise(r=>setTimeout(r,100));const calibrationSamples=[];const calibrationStart=performance.now();const calibrationDuration=2000;return new Promise(resolve=>{function calibrationLoop(timestamp){const elapsed=timestamp-calibrationStart;if(elapsed>=calibrationDuration){const avgFps=calibrationSamples.reduce((a,b)=>a+b,0)/calibrationSamples.length;state.baselineFps=avgFps;state.maxLoad=avgFps*1.5;state.calibrationComplete=true;DOM.baselineFps.textContent=avgFps.toFixed(1)+" FPS";DOM.loadCapacity.textContent=(state.maxLoad).toFixed(1)+" FPS";updateLoading(90,"Calibration Complete","Baseline: "+avgFps.toFixed(1)+" FPS");resolve(true);return;}const sceneData=programs["particles"];if(gl.intro&&!state.contextLost&&sceneData){gl.intro.clearColor(0.02,0.03,0.06,1.0);gl.intro.clear(gl.intro.COLOR_BUFFER_BIT);renderScene(gl.intro,sceneData,timestamp);}if(calibrationSamples.length>0){const lastTime=calibrationSamples[calibrationSamples.length-1];const fps=1000/(timestamp-lastTime);if(fps>0&&fps<1000)calibrationSamples.push(timestamp);}else{calibrationSamples.push(timestamp);}const progress=10+(elapsed/calibrationDuration)*80;updateLoading(progress,"Calibrating...","Measuring baseline performance");requestAnimationFrame(calibrationLoop);}requestAnimationFrame(calibrationLoop);});}
function showIntro(){DOM.loadOverlay.style.display="none";DOM.introOverlay.style.display="flex";requestAnimationFrame(introLoop);}
function introLoop(timestamp){if(DOM.introOverlay.style.display!=="flex")return;const duration=5000;const phase=Math.floor((timestamp%(duration*3))/duration);if(state.introPhase!==phase){state.introPhase=phase;}const scenes=["neon","particles","rain"];const sceneType=scenes[state.introPhase];const sceneData=programs[sceneType];if(gl.intro&&!state.contextLost){gl.intro.clearColor(0.02,0.03,0.06,1.0);gl.intro.clear(gl.intro.COLOR_BUFFER_BIT);if(sceneData)renderScene(gl.intro,sceneData,timestamp);}requestAnimationFrame(introLoop);}
function showMainUI(){DOM.introOverlay.style.display="none";DOM.mainUI.style.display="block";canvas.intro.style.display="none";canvas.main.style.display="block";detectSystem();startMainRender();}
function startMainRender(){state.startTime=performance.now();state.frameCount=0;state.fpsSamples=[];state.fpsHistory=[];state.lastFrameTime=performance.now();state.timestepAccumulator=0;requestAnimationFrame(mainLoop);}
function mainLoop(timestamp){if(!state.isVisible){if(state.benchRunning&&!state.benchPaused){state.benchPaused=true;state.benchPausedTime=timestamp;showNotification("Benchmark paused - tab hidden","warning");}requestAnimationFrame(mainLoop);return;}else if(state.benchPaused){state.benchPaused=false;const pauseDuration=timestamp-state.benchPausedTime;state.benchStartTime+=pauseDuration;showNotification("Benchmark resumed","success");}const deltaTime=(timestamp-state.lastFrameTime)/1000;const fpsCap=parseInt(DOM.fpsCap.value)||0;const shouldRender=fpsCap===0||(timestamp-state.lastFrameTime)>=(1000/fpsCap);if(shouldRender){state.frameCount++;const rawFps=deltaTime>0?1/deltaTime:0;const currentFps=Math.min(rawFps,500);state.lastFrameTime=timestamp;if(gl.main&&!state.contextLost){gl.main.clearColor(0.02,0.03,0.06,1.0);gl.main.clear(gl.main.COLOR_BUFFER_BIT);const sceneKey="main_"+state.currentScene;const currentSceneData=programs[sceneKey];if(currentSceneData)renderScene(gl.main,currentSceneData,timestamp);}state.fpsSamples.push(currentFps);if(state.fpsSamples.length>APP.maxFpsSamples)state.fpsSamples.shift();const avgFps=state.fpsSamples.reduce(function(a,b){return a+b;},0)/state.fpsSamples.length;state.fpsHistory.push(avgFps);if(state.fpsHistory.length>APP.fpsHistorySize)state.fpsHistory.shift();const loadPercent=state.calibrationComplete?(avgFps/state.maxLoad*100).toFixed(1):"N/A";DOM.footer.textContent="Status: "+(state.benchRunning?"Benchmarking":"Running")+" | FPS: "+avgFps.toFixed(1)+" | Load: "+loadPercent+"% | Frames: "+state.frameCount;if(state.perfGraphActive){updatePerfGraph(avgFps);}}if(state.benchRunning&&!state.benchPaused){if(state.benchSamples.length<APP.maxBenchSamples){const currentFps=deltaTime>0?Math.min(1/deltaTime,500):0;state.benchSamples.push({time:timestamp,fps:currentFps});}if(DOM.emergencyStopEnabled.checked){const elapsed=timestamp-state.benchStartTime;if(elapsed>APP.emergencyStopTime&&timestamp-state.lastEmergencyCheck>5000){state.lastEmergencyCheck=timestamp;DOM.emergencyStop.style.display="block";}}}if(state.physicsActive){state.timestepAccumulator+=Math.min(deltaTime,0.1);state.timestepAccumulator=Math.min(state.timestepAccumulator,APP.maxTimestepAccumulator);const fixedDt=parseFloat(DOM.timeStep.value);while(state.timestepAccumulator>=fixedDt){const method=DOM.integrationMethod.value;if(method==="euler")updatePhysicsEuler(fixedDt);else if(method==="rk4")updatePhysicsRK4(fixedDt);else if(method==="symplectic")updatePhysicsSymplectic(fixedDt);else if(method==="molecular")updatePhysicsMolecular(fixedDt);else updatePhysicsVerlet(fixedDt);state.timestepAccumulator-=fixedDt;}}requestAnimationFrame(mainLoop);}
function resize(){const scale=parseFloat(DOM.renderScale.value);const dpr=window.devicePixelRatio||1;const effectiveDpr=dpr*scale;canvas.main.width=window.innerWidth*effectiveDpr;canvas.main.height=window.innerHeight*effectiveDpr;canvas.intro.width=window.innerWidth*effectiveDpr;canvas.intro.height=window.innerHeight*effectiveDpr;canvas.particle.width=window.innerWidth;canvas.particle.height=window.innerHeight;canvas.main.style.width=window.innerWidth+"px";canvas.main.style.height=window.innerHeight+"px";canvas.intro.style.width=window.innerWidth+"px";canvas.intro.style.height=window.innerHeight+"px";if(gl.main)gl.main.viewport(0,0,canvas.main.width,canvas.main.height);if(gl.intro)gl.intro.viewport(0,0,canvas.intro.width,canvas.intro.height);}
function switchTab(tabName,btn){document.querySelectorAll(".tab-content").forEach(function(c){c.style.display="none";});const targetTab=document.getElementById(tabName);if(targetTab){targetTab.style.display="block";}document.querySelectorAll("#tabs button").forEach(function(b){b.classList.remove("active");});if(btn){btn.classList.add("active");}}
function createTabs(){const tabs=[{name:"world",label:"3D World"},{name:"physics",label:"Physics"},{name:"bench",label:"Benchmark"},{name:"games",label:"Games"},{name:"system",label:"System"},{name:"history",label:"History"}];tabs.forEach(function(tab,idx){const btn=document.createElement("button");btn.textContent=tab.label;btn.className=idx===0?"active":"";btn.addEventListener("click",function(){switchTab(tab.name,btn);});DOM.tabs.appendChild(btn);});}
function createButtons(){const worldBtns=[{label:"Generate",handler:generateWorld},{label:"Export",handler:exportWorld}];worldBtns.forEach(function(btn){const el=document.createElement("button");el.textContent=btn.label;el.addEventListener("click",btn.handler);DOM.worldControls.appendChild(el);});const physicsBtns=[{label:"Start",handler:startPhysics},{label:"Explosion",handler:addExplosion},{label:"Reset",handler:resetPhysics}];physicsBtns.forEach(function(btn){const el=document.createElement("button");el.textContent=btn.label;el.addEventListener("click",btn.handler);DOM.physicsControls.appendChild(el);});const benchBtns=[{label:"Start",handler:startBenchmark},{label:"Stop",handler:stopBenchmark,className:"danger"}];benchBtns.forEach(function(btn){const el=document.createElement("button");el.textContent=btn.label;el.addEventListener("click",btn.handler);if(btn.className)el.className=btn.className;DOM.benchControls.appendChild(el);});}
function detectSystem(){try{const debugInfo=gl.main.getExtension("WEBGL_debug_renderer_info");if(debugInfo){const gpu=gl.main.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);DOM.gpuInfo.textContent=gpu;}else{DOM.gpuInfo.textContent="WebGL (Generic)";}DOM.webglInfo.textContent=gl.main.getParameter(gl.main.VERSION);if(navigator.deviceMemory){DOM.ramInfo.textContent=navigator.deviceMemory*1024+" MB";}else if(performance.memory){DOM.ramInfo.textContent=Math.round(performance.memory.jsHeapSizeLimit/1048576)+" MB";}else{DOM.ramInfo.textContent="Unknown";}DOM.cpuInfo.textContent=navigator.hardwareConcurrency||"Unknown";DOM.screenInfo.textContent=screen.width+"x"+screen.height;DOM.deviceType.textContent=state.deviceType.charAt(0).toUpperCase()+state.deviceType.slice(1);const maxPart=getMaxParticles();DOM.renderPartCount.max=maxPart;DOM.simPartCount.max=maxPart;if(parseInt(DOM.renderPartCount.value)>maxPart){DOM.renderPartCount.value=maxPart;DOM.renderPartLabel.textContent=maxPart;}if(parseInt(DOM.simPartCount.value)>maxPart){DOM.simPartCount.value=maxPart;DOM.simPartLabel.textContent=maxPart;}}catch(e){showError("Detection Failed","Could not detect system",e.message);}}
function generateWorld(){const seed=parseInt(DOM.worldSeed.value);const renderDist=parseInt(DOM.renderDist.value);const detail=parseInt(DOM.chunkDetail.value);DOM.worldInfo.textContent="World Generated!\nSeed: "+seed+"\nRender Distance: "+renderDist+" chunks\nDetail Level: "+detail+"\nStatus: Active";state.currentScene=DOM.sceneType.value;showNotification("World generated!");}
function exportWorld(){const data={seed:DOM.worldSeed.value,renderDist:DOM.renderDist.value,detail:DOM.chunkDetail.value,scene:DOM.sceneType.value,timestamp:Date.now()};const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="world-"+Date.now()+".json";a.click();showNotification("World exported!");}
function startPhysics(){const maxPart=getMaxParticles();state.renderParticleCount=Math.min(parseInt(DOM.renderPartCount.value),maxPart);state.simParticleCount=Math.min(parseInt(DOM.simPartCount.value),maxPart);if(DOM.deterministicMode.checked){state.randomSeed=state.deterministicSeed;}else{state.randomSeed=Date.now()%100000;}state.physicsActive=true;state.particles=[];state.timestepAccumulator=0;const method=DOM.integrationMethod.value;for(let i=0;i<state.simParticleCount;i++){const angle=seededRandom()*Math.PI*2;const speed=seededRandom()*200+100;const p={x:canvas.particle.width/2,y:canvas.particle.height/2,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,ax:0,ay:0,mass:1.0+seededRandom()*0.5,life:1.0,visible:i<state.renderParticleCount};if(method==="verlet"||method==="symplectic"){p.px=p.x;p.py=p.y;}if(method==="rk4"){p.k1={vx:0,vy:0,ax:0,ay:0};p.k2={vx:0,vy:0,ax:0,ay:0};p.k3={vx:0,vy:0,ax:0,ay:0};p.k4={vx:0,vy:0,ax:0,ay:0};}if(method==="molecular"){p.fx=0;p.fy=0;p.radius=2+seededRandom()*2;}state.particles.push(p);}DOM.physicsLog.textContent="Physics Active\nMethod: "+method.toUpperCase()+"\nRender: "+state.renderParticleCount+"\nSimulate: "+state.simParticleCount+"\nDeterministic: "+(DOM.deterministicMode.checked?"YES":"NO");showNotification("Physics started!");}
function addExplosion(){if(!state.physicsActive)startPhysics();const centerX=canvas.particle.width/2;const centerY=canvas.particle.height/2;const explosionSize=Math.min(500,getMaxParticles()-state.particles.length);const method=DOM.integrationMethod.value;const currentRenderCount=state.particles.filter(p=>p.visible).length;for(let i=0;i<explosionSize;i++){const angle=seededRandom()*Math.PI*2;const speed=seededRandom()*300+200;const p={x:centerX,y:centerY,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,ax:0,ay:0,mass:1.0+seededRandom()*0.5,life:1.0,visible:currentRenderCount+i<state.renderParticleCount};if(method==="verlet"||method==="symplectic"){p.px=p.x;p.py=p.y;}if(method==="rk4"){p.k1={vx:0,vy:0,ax:0,ay:0};p.k2={vx:0,vy:0,ax:0,ay:0};p.k3={vx:0,vy:0,ax:0,ay:0};p.k4={vx:0,vy:0,ax:0,ay:0};}if(method==="molecular"){p.fx=0;p.fy=0;p.radius=2+seededRandom()*2;}state.particles.push(p);}showNotification("Explosion added!");}
function resetPhysics(){state.physicsActive=false;state.particles=[];state.timestepAccumulator=0;const ctx=canvas.particle.getContext("2d");ctx.clearRect(0,0,canvas.particle.width,canvas.particle.height);DOM.physicsLog.textContent="Advanced Physics Ready";showNotification("Physics reset");}
function clampVelocity(p){const maxVel=parseFloat(DOM.maxVelocity.value);const speed=Math.sqrt(p.vx*p.vx+p.vy*p.vy);if(speed>maxVel){const scale=maxVel/speed;p.vx*=scale;p.vy*=scale;}}
function computeAcceleration(p,particles,epsilon,sigma){const gravity=parseFloat(DOM.gravity.value);const pixelsPerMeter=10;const airRes=parseFloat(DOM.airRes.value);p.ax=-p.vx*airRes*10;p.ay=gravity*pixelsPerMeter-p.vy*airRes*10;if(DOM.integrationMethod.value==="molecular"&&particles){for(let j=0;j<particles.length;j++){const q=particles[j];if(p===q)continue;const dx=q.x-p.x;const dy=q.y-p.y;const r2=dx*dx+dy*dy;if(r2<1)continue;const r=Math.sqrt(r2);const sr=sigma/r;const sr6=sr*sr*sr*sr*sr*sr;const sr12=sr6*sr6;const fmag=24*epsilon*(2*sr12-sr6)/r;p.ax+=fmag*dx/r;p.ay+=fmag*dy/r;}}}
function updatePhysicsEuler(dt){if(state.particles.length===0){state.physicsActive=false;return;}const bounce=parseFloat(DOM.bounceFactor.value);const w=canvas.particle.width;const h=canvas.particle.height;state.particles=state.particles.filter(function(p){computeAcceleration(p,null);p.vx+=p.ax*dt;p.vy+=p.ay*dt;clampVelocity(p);p.x+=p.vx*dt;p.y+=p.vy*dt;if(p.y>h){p.y=h;p.vy=-p.vy*bounce;}if(p.y<0){p.y=0;p.vy=-p.vy*bounce;}if(p.x<0){p.x=0;p.vx=-p.vx*bounce;}if(p.x>w){p.x=w;p.vx=-p.vx*bounce;}p.life-=dt*0.2;return p.life>0;});renderParticlesBatched();updatePhysicsDisplay("EULER");}
function updatePhysicsRK4(dt){if(state.particles.length===0){state.physicsActive=false;return;}const bounce=parseFloat(DOM.bounceFactor.value);const w=canvas.particle.width;const h=canvas.particle.height;state.particles=state.particles.filter(function(p){const x0=p.x;const y0=p.y;const vx0=p.vx;const vy0=p.vy;computeAcceleration(p,null);p.k1.vx=p.ax;p.k1.vy=p.ay;p.k1.ax=p.vx;p.k1.ay=p.vy;p.x=x0+p.k1.ax*dt*0.5;p.y=y0+p.k1.ay*dt*0.5;p.vx=vx0+p.k1.vx*dt*0.5;p.vy=vy0+p.k1.vy*dt*0.5;computeAcceleration(p,null);p.k2.vx=p.ax;p.k2.vy=p.ay;p.k2.ax=p.vx;p.k2.ay=p.vy;p.x=x0+p.k2.ax*dt*0.5;p.y=y0+p.k2.ay*dt*0.5;p.vx=vx0+p.k2.vx*dt*0.5;p.vy=vy0+p.k2.vy*dt*0.5;computeAcceleration(p,null);p.k3.vx=p.ax;p.k3.vy=p.ay;p.k3.ax=p.vx;p.k3.ay=p.vy;p.x=x0+p.k3.ax*dt;p.y=y0+p.k3.ay*dt;p.vx=vx0+p.k3.vx*dt;p.vy=vy0+p.k3.vy*dt;computeAcceleration(p,null);p.k4.vx=p.ax;p.k4.vy=p.ay;p.k4.ax=p.vx;p.k4.ay=p.vy;p.x=x0+(p.k1.ax+2*p.k2.ax+2*p.k3.ax+p.k4.ax)*dt/6;p.y=y0+(p.k1.ay+2*p.k2.ay+2*p.k3.ay+p.k4.ay)*dt/6;p.vx=vx0+(p.k1.vx+2*p.k2.vx+2*p.k3.vx+p.k4.vx)*dt/6;p.vy=vy0+(p.k1.vy+2*p.k2.vy+2*p.k3.vy+p.k4.vy)*dt/6;clampVelocity(p);if(p.y>h){p.y=h;p.vy=-p.vy*bounce;}if(p.y<0){p.y=0;p.vy=-p.vy*bounce;}if(p.x<0){p.x=0;p.vx=-p.vx*bounce;}if(p.x>w){p.x=w;p.vx=-p.vx*bounce;}p.life-=dt*0.2;return p.life>0;});renderParticlesBatched();updatePhysicsDisplay("RK4");}
function updatePhysicsSymplectic(dt){if(state.particles.length===0){state.physicsActive=false;return;}const bounce=parseFloat(DOM.bounceFactor.value);const w=canvas.particle.width;const h=canvas.particle.height;state.particles=state.particles.filter(function(p){computeAcceleration(p,null);p.vx+=p.ax*dt;p.vy+=p.ay*dt;clampVelocity(p);const oldX=p.x;const oldY=p.y;p.x+=p.vx*dt;p.y+=p.vy*dt;if(p.y>h){p.y=h;p.vy=-p.vy*bounce;}if(p.y<0){p.y=0;p.vy=-p.vy*bounce;}if(p.x<0){p.x=0;p.vx=-p.vx*bounce;}if(p.x>w){p.x=w;p.vx=-p.vx*bounce;}p.px=oldX;p.py=oldY;p.life-=dt*0.2;return p.life>0;});renderParticlesBatched();updatePhysicsDisplay("SYMPLECTIC");}
function updatePhysicsMolecular(dt){if(state.particles.length===0){state.physicsActive=false;return;}const bounce=parseFloat(DOM.bounceFactor.value);const w=canvas.particle.width;const h=canvas.particle.height;const epsilon=parseFloat(DOM.ljEpsilon.value);const sigma=parseFloat(DOM.ljSigma.value);for(let i=0;i<state.particles.length;i++){state.particles[i].fx=0;state.particles[i].fy=0;}for(let i=0;i<state.particles.length;i++){const p=state.particles[i];computeAcceleration(p,state.particles,epsilon,sigma);}state.particles=state.particles.filter(function(p){p.vx+=p.ax*dt;p.vy+=p.ay*dt;clampVelocity(p);p.x+=p.vx*dt;p.y+=p.vy*dt;if(p.y>h){p.y=h;p.vy=-p.vy*bounce;}if(p.y<0){p.y=0;p.vy=-p.vy*bounce;}if(p.x<0){p.x=0;p.vx=-p.vx*bounce;}if(p.x>w){p.x=w;p.vx=-p.vx*bounce;}p.life-=dt*0.15;return p.life>0;});renderParticlesBatched();updatePhysicsDisplay("MOLECULAR");}
function updatePhysicsVerlet(dt){if(state.particles.length===0){state.physicsActive=false;return;}const gravity=parseFloat(DOM.gravity.value);const airRes=parseFloat(DOM.airRes.value);const bounce=parseFloat(DOM.bounceFactor.value);const w=canvas.particle.width;const h=canvas.particle.height;const pixelsPerMeter=10;state.particles=state.particles.filter(function(p){const vx=p.x-p.px;const vy=p.y-p.py;const speed=Math.sqrt(vx*vx+vy*vy);const maxVel=parseFloat(DOM.maxVelocity.value);let dampFactor=1;if(speed>maxVel){dampFactor=maxVel/speed;}p.px=p.x;p.py=p.y;const ax=0;const ay=gravity*pixelsPerMeter;p.x+=vx*dampFactor*(1-airRes)+ax*dt*dt;p.y+=vy*dampFactor*(1-airRes)+ay*dt*dt;if(p.y>h){p.y=h;const tempY=p.py;p.py=p.y+(p.y-tempY)*bounce;p.y=h;}if(p.y<0){p.y=0;const tempY=p.py;p.py=p.y+(p.y-tempY)*bounce;p.y=0;}if(p.x<0){p.x=0;const tempX=p.px;p.px=p.x+(p.x-tempX)*bounce;p.x=0;}if(p.x>w){p.x=w;const tempX=p.px;p.px=p.x+(p.x-tempX)*bounce;p.x=w;}p.life-=dt*0.2;return p.life>0;});renderParticlesBatched();updatePhysicsDisplay("VERLET");}
function renderParticlesBatched(){const ctx=canvas.particle.getContext("2d");const w=canvas.particle.width;const h=canvas.particle.height;ctx.fillStyle="rgba(2,4,10,0.15)";ctx.fillRect(0,0,w,h);const visibleParticles=state.particles.filter(p=>p.visible);ctx.beginPath();visibleParticles.forEach(function(p){const size=p.radius||(2+p.life*2);ctx.moveTo(p.x+size,p.y);ctx.arc(p.x,p.y,size,0,Math.PI*2);});ctx.fillStyle="rgba(0,212,255,0.7)";ctx.fill();}
function updatePhysicsDisplay(method){const gravity=parseFloat(DOM.gravity.value);const airRes=parseFloat(DOM.airRes.value);const bounce=parseFloat(DOM.bounceFactor.value);const dt=parseFloat(DOM.timeStep.value);const maxVel=parseFloat(DOM.maxVelocity.value);let energySum=0;state.particles.forEach(function(p){const v2=p.vx*p.vx+p.vy*p.vy;energySum+=0.5*p.mass*v2;});const visibleCount=state.particles.filter(p=>p.visible).length;DOM.physicsData.textContent="Method: "+method+"\nTotal: "+state.particles.length+"\nVisible: "+visibleCount+"\nGravity: "+gravity.toFixed(1)+" m/sÂ²\nAir Res: "+airRes.toFixed(3)+"\nBounce: "+bounce.toFixed(2)+"\nMax Vel: "+maxVel+"\nTimestep: "+dt.toFixed(4)+"s\nKinetic E: "+energySum.toFixed(0);}
function startBenchmark(){if(state.benchRunning)return;const duration=parseInt(DOM.benchDuration.value)*1000;const thermalAccepted=DOM.thermalWarning.checked;const stressMode=DOM.stressMode.value;if(duration>300000&&!thermalAccepted){showNotification("Please accept thermal warning for >5min tests","warning");return;}if(stressMode==="extreme"&&!thermalAccepted){showNotification("Extreme mode requires thermal warning","warning");return;}if(DOM.deterministicMode.checked){state.randomSeed=state.deterministicSeed;showNotification("Deterministic mode: Seed "+state.deterministicSeed);}state.benchRunning=true;state.benchPaused=false;state.benchSamples=[];state.benchStartTime=performance.now();state.lastEmergencyCheck=0;DOM.benchResults.textContent="Benchmark Running...\nDuration: "+(duration/1000)+"s\nMode: "+stressMode+"\nDeterministic: "+(DOM.deterministicMode.checked?"YES":"NO")+"\n\nPlease wait...";showNotification("Benchmark started!");setTimeout(function(){if(state.benchRunning)finalizeBenchmark();},duration);}
function stopBenchmark(){if(!state.benchRunning)return;state.benchRunning=false;state.benchPaused=false;DOM.emergencyStop.style.display="none";finalizeBenchmark();showNotification("Benchmark stopped");}
function forceStopBenchmark(){stopBenchmark();showNotification("Emergency stop activated!","warning");}
function finalizeBenchmark(){state.benchRunning=false;state.benchPaused=false;DOM.emergencyStop.style.display="none";if(state.benchSamples.length===0){DOM.benchResults.textContent="No data collected";showNotification("Benchmark failed","error");return;}const fps=state.benchSamples.map(function(s){return s.fps;});const avgFps=fps.reduce(function(sum,f){return sum+f;},0)/fps.length;const minFps=Math.min.apply(Math,fps);const maxFps=Math.max.apply(Math,fps);const duration=(performance.now()-state.benchStartTime)/1000;const percentile1=calculatePercentile(fps,0.01);const percentile01=calculatePercentile(fps,0.001);const relativeLoad=state.calibrationComplete?(avgFps/state.baselineFps*100).toFixed(1):"N/A";state.lastBenchmark={avgFps:avgFps,minFps:minFps,maxFps:maxFps,duration:duration,samples:state.benchSamples.length,scene:state.currentScene,timestamp:Date.now(),percentile1:percentile1,percentile01:percentile01,gpu:DOM.gpuInfo.textContent,resolution:DOM.screenInfo.textContent,deviceType:state.deviceType,baselineFps:state.baselineFps,relativeLoad:relativeLoad,deterministicSeed:DOM.deterministicMode.checked?state.deterministicSeed:null};state.history.push(state.lastBenchmark);while(state.history.length>APP.maxHistoryItems){state.history.shift();}saveToLocalStorage();DOM.benchResults.textContent="Benchmark Complete!\n\nAverage FPS: "+avgFps.toFixed(2)+"\nMinimum FPS: "+minFps.toFixed(2)+"\nMaximum FPS: "+maxFps.toFixed(2)+"\n1% Low: "+percentile1.toFixed(2)+"\n0.1% Low: "+percentile01.toFixed(2)+"\nDuration: "+duration.toFixed(1)+"s\nSamples: "+state.benchSamples.length+"\nRelative Load: "+relativeLoad+"%\n\nGPU: "+DOM.gpuInfo.textContent;showNotification("Benchmark completed!");analyzeGames();}
function calculatePercentile(arr,p){if(arr.length===0)return 0;const sorted=arr.slice().sort(function(a,b){return a-b;});const index=Math.floor(sorted.length*p);return sorted[Math.max(0,index)]||0;}
const gamesList=[{name:"Cyberpunk 2077",minFps:60,category:"AAA RPG"},{name:"Starfield",minFps:60,category:"AAA RPG"},{name:"Baldurs Gate 3",minFps:60,category:"AAA RPG"},{name:"Alan Wake 2",minFps:60,category:"AAA Action"},{name:"Spider-Man Remastered",minFps:60,category:"AAA Action"},{name:"Hogwarts Legacy",minFps:60,category:"AAA RPG"},{name:"God of War RagnarÃ¶k",minFps:60,category:"AAA Action"},{name:"Forza Horizon 5",minFps:60,category:"Racing"},{name:"Apex Legends",minFps:144,category:"Battle Royale"},{name:"Valorant",minFps:144,category:"FPS"},{name:"CS2",minFps:144,category:"FPS"},{name:"Fortnite",minFps:120,category:"Battle Royale"},{name:"Warzone",minFps:120,category:"Battle Royale"},{name:"Overwatch 2",minFps:120,category:"FPS"},{name:"PUBG",minFps:100,category:"Battle Royale"},{name:"League of Legends",minFps:144,category:"MOBA"},{name:"Dota 2",minFps:120,category:"MOBA"},{name:"Rocket League",minFps:120,category:"Sports"},{name:"Minecraft",minFps:60,category:"Sandbox"},{name:"Elden Ring",minFps:60,category:"RPG"},{name:"Dark Souls 3",minFps:60,category:"RPG"},{name:"Monster Hunter World",minFps:60,category:"Action RPG"},{name:"Final Fantasy XIV",minFps:60,category:"MMORPG"},{name:"World of Warcraft",minFps:60,category:"MMORPG"},{name:"Genshin Impact",minFps:60,category:"RPG"},{name:"Diablo IV",minFps:60,category:"ARPG"}];function analyzeGames(){if(!state.lastBenchmark){DOM.gamesList.innerHTML='<div style="color:var(--muted);margin:10px 0;text-align:center">Run benchmark first</div>';return;}const benchFps=state.lastBenchmark.avgFps;const resolution=DOM.targetRes.value;const graphics=DOM.graphicsPreset.value;let fpsMultiplier=1.0;if(resolution==="720p")fpsMultiplier=1.5;else if(resolution==="1440p")fpsMultiplier=0.7;else if(resolution==="4k")fpsMultiplier=0.4;if(graphics==="low")fpsMultiplier*=1.4;else if(graphics==="ultra")fpsMultiplier*=0.8;const deviceMultiplier=state.deviceType==="mobile"?0.6:state.deviceType==="tablet"?0.8:1.0;const baseAdjusted=benchFps*fpsMultiplier*deviceMultiplier;let html="";const categories={};gamesList.forEach(function(game){if(!categories[game.category])categories[game.category]=[];categories[game.category].push(game);});Object.keys(categories).sort().forEach(function(category){html+='<div class="game-category">'+category+'</div>';categories[category].forEach(function(game){const variance=0.85+Math.random()*0.3;const predicted=baseAdjusted*variance;const ratio=predicted/game.minFps;let performance,perfClass;if(ratio>=2){performance="Ultra ("+Math.round(predicted)+"fps)";perfClass="ultra";}else if(ratio>=1.5){performance="High ("+Math.round(predicted)+"fps)";perfClass="high";}else if(ratio>=1){performance="Medium ("+Math.round(predicted)+"fps)";perfClass="medium";}else if(ratio>=0.6){performance="Low ("+Math.round(predicted)+"fps)";perfClass="low";}else{performance="Unplayable";perfClass="unplayable";}html+='<div class="game-item '+perfClass+'"><span>'+game.name+'</span><span style="font-weight:bold">'+performance+'</span></div>';});});DOM.gamesList.innerHTML=html;}
function loadHistory(){displayHistory();}
function displayHistory(){if(state.history.length===0){DOM.historyList.innerHTML='<div style="color:var(--muted);text-align:center;padding:20px">No benchmark history</div>';return;}let html="";state.history.slice().reverse().forEach(function(bench,idx){const realIdx=state.history.length-1-idx;const date=new Date(bench.timestamp);const isSelected=state.selectedHistoryItems.has(realIdx);const detMark=bench.deterministicSeed?"ðŸ”’":"";html+='<div class="history-item '+(isSelected?"selected":"")+'" onclick="selectHistory('+realIdx+')"><div><strong>'+detMark+date.toLocaleDateString()+" "+date.toLocaleTimeString()+'</strong></div><div style="font-size:10px;color:var(--muted);margin-top:2px">Avg: '+bench.avgFps.toFixed(1)+" FPS | 1%: "+bench.percentile1.toFixed(1)+" | Load: "+(bench.relativeLoad||"N/A")+'%</div></div>';});DOM.historyList.innerHTML=html;}
function selectHistory(idx){if(state.selectedHistoryItems.has(idx)){state.selectedHistoryItems.delete(idx);}else{state.selectedHistoryItems.add(idx);}displayHistory();if(state.selectedHistoryItems.size===1){const bench=state.history[idx];showBenchmarkDetails(bench);}else if(state.selectedHistoryItems.size>1){compareSelectedBenchmarks();}}
function showBenchmarkDetails(bench){const date=new Date(bench.timestamp);const detInfo=bench.deterministicSeed?"Seed: "+bench.deterministicSeed:"Random";DOM.compareResults.innerHTML='<div style="padding:10px"><div style="font-weight:bold;color:var(--accent);margin-bottom:8px">Benchmark Details</div><div style="font-size:10px;color:var(--muted);margin-bottom:8px">'+date.toLocaleString()+'</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:6px"><div>Avg FPS</div><div style="text-align:right">'+bench.avgFps.toFixed(2)+'</div><div>Min FPS</div><div style="text-align:right">'+bench.minFps.toFixed(2)+'</div><div>Max FPS</div><div style="text-align:right">'+bench.maxFps.toFixed(2)+'</div><div>1% Low</div><div style="text-align:right">'+bench.percentile1.toFixed(2)+'</div><div>0.1% Low</div><div style="text-align:right">'+bench.percentile01.toFixed(2)+'</div><div>Duration</div><div style="text-align:right">'+bench.duration.toFixed(1)+'s</div><div>Scene</div><div style="text-align:right">'+bench.scene+'</div><div>Load</div><div style="text-align:right">'+(bench.relativeLoad||"N/A")+'%</div><div>Mode</div><div style="text-align:right">'+detInfo+'</div></div></div>';}
function compareSelectedBenchmarks(){const selected=Array.from(state.selectedHistoryItems).sort();if(selected.length<2)return;const benchmarks=selected.map(function(idx){return state.history[idx];});let html='<div style="padding:10px"><div style="font-weight:bold;color:var(--accent);margin-bottom:8px">Compare Benchmarks</div>';html+='<div style="font-size:10px;margin-bottom:8px">Comparing '+benchmarks.length+' benchmarks</div>';const metrics=[{key:"avgFps",label:"Avg FPS"},{key:"percentile1",label:"1% Low"},{key:"percentile01",label:"0.1% Low"}];metrics.forEach(function(metric){const values=benchmarks.map(function(b){return b[metric.key];});const best=Math.max.apply(Math,values);const worst=Math.min.apply(Math,values);const improvement=((best-worst)/worst*100).toFixed(1);html+='<div style="margin-top:8px"><div style="color:var(--muted);font-size:10px">'+metric.label+'</div><div style="display:flex;justify-content:space-between;margin-top:2px"><span>Best: '+best.toFixed(2)+'</span><span>Worst: '+worst.toFixed(2)+'</span><span style="color:'+(improvement>0?"var(--good)":"var(--muted)")+'">+'+ improvement+'%</span></div></div>';});html+="</div>";DOM.compareResults.innerHTML=html;}
function clearHistory(){if(!confirm("Clear all history?"))return;state.history=[];state.selectedHistoryItems.clear();localStorage.removeItem("neonforge_history");displayHistory();DOM.compareResults.innerHTML="";showNotification("History cleared");}
function exportHistory(){if(state.history.length===0){showNotification("No history to export","warning");return;}const blob=new Blob([JSON.stringify(state.history,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="history-"+Date.now()+".json";a.click();showNotification("History exported!");}
function saveToLocalStorage(){try{localStorage.setItem("neonforge_history",JSON.stringify(state.history));}catch(e){console.error("Failed to save",e);}}
function loadFromLocalStorage(){try{const stored=localStorage.getItem("neonforge_history");if(stored){state.history=JSON.parse(stored);}}catch(e){console.error("Failed to load",e);}}
function updatePerfGraph(fps){const ctx=DOM.perfCanvas.getContext("2d");const w=DOM.perfCanvas.width;const h=DOM.perfCanvas.height;ctx.fillStyle="#020408";ctx.fillRect(0,0,w,h);if(state.fpsHistory.length<2)return;ctx.strokeStyle="#00d4ff";ctx.lineWidth=2;ctx.beginPath();const maxFps=Math.max.apply(Math,state.fpsHistory.concat([60]));state.fpsHistory.forEach(function(f,i){const x=(i/(state.fpsHistory.length-1))*w;const y=h-((f/maxFps)*h*0.9);if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);});ctx.stroke();ctx.fillStyle="#7a92c4";ctx.font="10px monospace";ctx.fillText("FPS",5,15);ctx.fillText(fps.toFixed(1),5,h-5);ctx.fillText(maxFps.toFixed(0),w-30,15);}
function setupEventListeners(){DOM.startBtn.addEventListener("click",showMainUI);DOM.skipBtn.addEventListener("click",showMainUI);DOM.errorRetry.addEventListener("click",function(){hideError();window.location.reload();});DOM.sceneType.addEventListener("change",function(e){state.currentScene=e.target.value;});DOM.worldSeed.addEventListener("input",function(e){DOM.seedLabel.textContent=e.target.value;});DOM.renderDist.addEventListener("input",function(e){DOM.renderLabel.textContent=e.target.value;});DOM.chunkDetail.addEventListener("input",function(e){DOM.detailLabel.textContent=e.target.value;});DOM.gravity.addEventListener("input",function(e){DOM.gravLabel.textContent=e.target.value;});DOM.airRes.addEventListener("input",function(e){DOM.airLabel.textContent=e.target.value;});DOM.bounceFactor.addEventListener("input",function(e){DOM.bounceLabel.textContent=e.target.value;});DOM.renderPartCount.addEventListener("input",function(e){DOM.renderPartLabel.textContent=e.target.value;state.renderParticleCount=parseInt(e.target.value);});DOM.simPartCount.addEventListener("input",function(e){DOM.simPartLabel.textContent=e.target.value;state.simParticleCount=parseInt(e.target.value);});DOM.timeStep.addEventListener("input",function(e){DOM.dtLabel.textContent=e.target.value;});DOM.ljEpsilon.addEventListener("input",function(e){DOM.ljEpsilonLabel.textContent=e.target.value;});DOM.ljSigma.addEventListener("input",function(e){DOM.ljSigmaLabel.textContent=e.target.value;});DOM.maxVelocity.addEventListener("input",function(e){DOM.maxVelLabel.textContent=e.target.value;});DOM.renderScale.addEventListener("input",function(e){DOM.renderScaleLabel.textContent=parseFloat(e.target.value).toFixed(2)+"x";state.renderScale=parseFloat(e.target.value);resize();});DOM.perfProfile.addEventListener("change",function(){if(state.lastBenchmark)analyzeGames();});DOM.targetRes.addEventListener("change",function(){if(state.lastBenchmark)analyzeGames();});DOM.graphicsPreset.addEventListener("change",function(){if(state.lastBenchmark)analyzeGames();});DOM.integrationMethod.addEventListener("change",function(){const method=DOM.integrationMethod.value;if(method==="molecular"){DOM.ljEpsilon.parentElement.style.display="block";DOM.ljSigma.parentElement.style.display="block";}else{DOM.ljEpsilon.parentElement.style.display="none";DOM.ljSigma.parentElement.style.display="none";}});document.addEventListener("visibilitychange",function(){state.isVisible=!document.hidden;});window.addEventListener("resize",resize);}
async function initialize(){try{initDOM();detectDevice();updateLoading(5,"Initializing WebGL...","Starting graphics system");await new Promise(function(r){setTimeout(r,200);});if(!initWebGL()){return;}updateLoading(15,"Compiling shaders...","Building render pipeline");await new Promise(function(r){setTimeout(r,300);});initScenes();await runCalibration();updateLoading(95,"Setting up interface...","Finalizing");await new Promise(function(r){setTimeout(r,200);});createTabs();createButtons();setupEventListeners();loadFromLocalStorage();resize();detectSystem();updateLoading(100,"Ready!","Calibration complete");await new Promise(function(r){setTimeout(r,300);});showIntro();}catch(e){showError("Init Failed","Failed to initialize",e.message);}}
window.addEventListener("load",initialize);
</script></body></html>
